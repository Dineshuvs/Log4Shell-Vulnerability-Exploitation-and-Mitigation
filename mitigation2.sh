#!/bin/bash

# Define the Dockerfile path
DOCKERFILE_PATH="./Dockerfile"

# Define the line number to update
LINE_NUMBER=5

# Define the new line to add
NEW_LINE="ENV LOG4J_FORMAT_MSG_NO_LOOKUPS=true"

# Use sed to update the Dockerfile
sed -i "${LINE_NUMBER}a ${NEW_LINE}" $DOCKERFILE_PATH
cd ./vulnerable-application/
mvn clean package
chmod 777 ./target/*.war
# Move the resulting .war file to the target directory
cd ..
mv ./vulnerable-application/target/*.war ./target/*.war

echo "Build complete"
docker build -t log4-shell-mitigation2 .
echo "Mitigation 2 image build"
