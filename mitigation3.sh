#!/bin/bash

# Specify the path to the file
file_path="./vulnerable-application/src/main/webapp/WEB-INF/web.xml"

# Define the search and replace strings
search_string="<servlet-class>com.example.log4shell.LoginServlet</servlet-class>"
replace_string="<servlet-class>com.example.log4shell.LoginServlet_withHardening</servlet-class>"

# Use sed to perform the replacement
sed -i "s|$search_string|$replace_string|g" "$file_path"

echo "Replacement complete."
cd ./vulnerable-application
mvn clean package
chmod 777 ./target/*.war
cd ..
# Move the resulting .war file to the target directory
mv ./vulnerable-application/target/*.war ./target/*.war

docker build -t log4-shell-mitigation3 .
echo "Mitigation 3 image build successfully"



